# 멀티스레드 채팅 시스템

이 프로젝트는 Python 소켓 프로그래밍을 사용한 멀티스레드 채팅 시스템입니다. 실시간 메시징, 파일 전송, AI 채팅, 채팅방 기능 등을 제공합니다.

## 📋 주요 기능

### 기본 채팅 기능
- **브로드캐스트 메시지**: 연결된 모든 사용자에게 메시지 전송
- **1:1 개인 메시지**: 특정 사용자에게 개인 메시지 전송
- **실시간 메시징**: 멀티스레드를 이용한 실시간 메시지 송수신

### 고급 기능
- **파일 전송**: 사용자 간 파일 송수신
- **AI 채팅**: OpenAI API(Upstage Solar) 연동 AI 채팅
- **채팅방 시스템**: 다중 사용자 채팅방 생성 및 관리
- **대화 기록 관리**: JSON 형태로 채팅 로그 저장 및 조회
- **채팅 내역 검색**: 키워드 기반 대화 내용 검색
- **채팅 내역 내보내기**: 특정 기간의 채팅 기록 파일로 저장

## 🛠️ 필요 사항

### Python 패키지
```bash
pip install openai python-dotenv
```

### 환경 설정
`.env` 파일에 OpenAI API 키 설정:
```
OPENAI_API_KEY=your_api_key_here
```

## 🚀 사용법

### 1. 서버 실행
```bash
python "7_Server_th_dict no class.py"
```

### 2. 클라이언트 실행
```bash
python 7_threadChatClient.py
```

### 3. 연결 및 사용
1. 클라이언트 실행 후 사용자 ID 입력
2. 아래 명령어들을 사용하여 채팅 시작

## 📝 명령어 목록

| 명령어 | 형식 | 설명 |
|--------|------|------|
| **브로드캐스트** | `BR:메시지` | 모든 사용자에게 메시지 전송 |
| **개인 메시지** | `TO:사용자ID:메시지` | 특정 사용자에게 메시지 전송 |
| **파일 전송** | `FILE:사용자ID:파일경로` | 파일 전송 |
| **AI 채팅** | `AICHAT:질문내용` | AI와 채팅 |
| **채팅방 생성** | `ROOM:CREATE:방이름` | 새 채팅방 생성 |
| **채팅방 참여** | `ROOM:JOIN:방이름` | 채팅방 참여 |
| **채팅방 나가기** | `ROOM:LEAVE:방이름` | 채팅방 나가기 |
| **방 메시지** | `RMSG:방이름:메시지` | 채팅방에 메시지 전송 |
| **방 목록** | `RLIST` | 채팅방 목록 조회 |
| **방 멤버** | `RMEM:방이름` | 채팅방 멤버 목록 조회 |
| **대화 기록** | `HISTORY:대상ID:날짜(YYYY-MM-DD)` | 특정 날짜 대화 기록 조회 |
| **내역 저장** | `EXPORT:시작일:종료일` | 기간별 채팅 내역 저장 |
| **내용 검색** | `SEARCH:검색어` | 대화 내용 검색 |
| **종료** | `Q` | 프로그램 종료 |

## 📁 파일 구조

```
my_socket_protocol_dev/
├── 7_threadChatClient.py      # 클라이언트 코드
├── 7_Server_th_dict no class.py  # 서버 코드
├── .env                       # 환경 변수 파일
├── History_files/             # 채팅 내역 저장 폴더
├── log_files/                 # 일일 채팅 로그 폴더
└── received_files/            # 수신된 파일 저장 폴더
```

## ⚙️ 기술 세부사항

### 서버
- **포트**: 10000번 포트 사용
- **프로토콜**: TCP 소켓 통신
- **멀티스레딩**: 각 클라이언트별 별도 스레드 생성
- **데이터 저장**: JSON 형태로 채팅 로그 저장

### 클라이언트
- **메시지 수신**: 별도 데몬 스레드로 실시간 메시지 수신
- **명령어 파싱**: 콜론(`:`) 구분자 기반 명령어 처리
- **파일 전송**: 바이너리 모드로 파일 청크 단위 전송

### 메시지 프로토콜
모든 메시지는 콜론(`:`)으로 구분된 형태:
```
명령어:발신자ID:추가파라미터:...
```

## 🔧 설정

### 서버 설정
```python
HOST = ''          # 모든 인터페이스
PORT = 10000       # 서버 포트
BUFSIZE = 1024     # 버퍼 크기
```

### 클라이언트 설정
```python
SERVER_HOST = "127.0.0.1"  # 서버 IP
SERVER_PORT = 10000        # 서버 포트
BUF_SIZE = 1024           # 버퍼 크기
```

## 📊 로그 관리

### 일일 로그
- 파일명: `log_files/chat_log_YYYY-MM-DD.json`
- 형식: 한 줄당 하나의 JSON 객체

### 내보내기 파일
- 파일명: `History_files/chat_history_사용자ID_시작일_종료일.json`
- 형식: JSON 배열

## 🚨 주의사항

1. **방화벽 설정**: 10000번 포트가 열려있어야 합니다
2. **API 키**: OpenAI API 키가 `.env` 파일에 설정되어야 AI 채팅이 작동합니다
3. **파일 권한**: 로그 및 파일 저장을 위한 쓰기 권한이 필요합니다
4. **네트워크**: 서버와 클라이언트가 같은 네트워크에 있어야 합니다

## 🐛 문제 해결

### 연결 실패
- 서버가 실행 중인지 확인
- 방화벽 설정 확인
- IP 주소와 포트 번호 확인

### AI 채팅 오류
- `.env` 파일의 API 키 확인
- 인터넷 연결 상태 확인
- API 키의 유효성 확인

### 파일 전송 실패
- 파일 경로 확인
- 파일 읽기 권한 확인
- 파일 크기 확인 (네트워크 제한)

## 📄 라이선스

이 프로젝트는 교육 목적으로 제작되었습니다. 